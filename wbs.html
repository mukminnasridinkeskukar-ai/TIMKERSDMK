<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Form WBS Sederhana</title>
<style>
body { font-family: Arial; padding:20px; background:#f0f8ff; }
form { max-width:600px; margin:auto; background:white; padding:20px; border-radius:10px; box-shadow:0 0 15px rgba(0,0,0,0.1);}
label { display:block; margin-top:10px; font-weight:bold; }
input, textarea, select { width:100%; padding:8px; margin-top:5px; border-radius:5px; border:1px solid #ccc; }
textarea { resize:vertical; }
button { margin-top:15px; padding:10px 20px; background:#004080; color:white; border:none; border-radius:5px; cursor:pointer; }
button:hover { background:#0066cc; }
.required { color:red; }
</style>
</head>
<body>

<h2>Form Whistleblowing System (WBS)</h2>

<form id="wbsForm">
<label>Nama Pelapor <span class="required">*</span></label>
<input type="text" id="nama" required>

<label>Email Pelapor <span class="required">*</span></label>
<input type="email" id="email" required>

<label>Nomor Telepon</label>
<input type="text" id="telp">

<label>Jenis Pelanggaran <span class="required">*</span></label>
<select id="jenis" required>
  <option value="">Loading...</option>
</select>

<label>Deskripsi Pelanggaran <span class="required">*</span></label>
<textarea id="deskripsi" rows="5" required></textarea>

<label>Apakah ingin anonim?</label>
<select id="anonim">
  <option value="Tidak">Tidak</option>
  <option value="Ya">Ya</option>
</select>

<button type="submit">Kirim Laporan</button>
</form>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbwEiLaElJuDfrTOsgjL7jcsgFpggURX6Vtqd5IOOp1EmS3ta9r9l8nHUSaek067Nmwp3A/exec'; // Ganti dengan URL Web App

// Load dropdown jenis pelanggaran
async function loadJenis() {
  try {
    const res = await fetch(scriptURL + "?action=getJenisPelaporan");
    const data = await res.json();
    const select = document.getElementById('jenis');
    select.innerHTML = '<option value="">Pilih jenis pelanggaran</option>';
    data.forEach(item => {
      const opt = document.createElement('option');
      opt.value = item;
      opt.textContent = item;
      select.appendChild(opt);
    });
  } catch(err) {
    console.error("Gagal ambil dropdown:", err);
    document.getElementById('jenis').innerHTML = '<option value="">Gagal load jenis pelanggaran</option>';
  }
}
loadJenis();

// Submit form
document.getElementById('wbsForm').addEventListener('submit', async e => {
  e.preventDefault();

  const formData = new FormData();
  formData.append('nama', document.getElementById('nama').value);
  formData.append('email', document.getElementById('email').value);
  formData.append('telp', document.getElementById('telp').value);
  formData.append('jenis', document.getElementById('jenis').value);
  formData.append('deskripsi', document.getElementById('deskripsi').value);
  formData.append('anonim', document.getElementById('anonim').value);

  fetch(scriptURL, { method: 'POST', body: formData })
    .then(res => res.json())
    .then(data => {
      alert("Laporan berhasil dikirim!");
      document.getElementById('wbsForm').reset();
      loadJenis();
    })
    .catch(err => {
      console.error(err);
      alert("Terjadi kesalahan. Coba lagi.");
    });
});
</script>

</body>
</html>
