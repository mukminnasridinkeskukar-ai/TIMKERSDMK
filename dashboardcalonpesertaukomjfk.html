<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard UKOM JFK</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{background:#f4f6f9;font-family:"Segoe UI",Arial}
.header{
  background:linear-gradient(135deg,#0d6efd,#084298);
  color:#fff;padding:20px 24px;border-radius:16px;margin-bottom:20px
}
.avatar{width:42px;height:42px;border-radius:50%;object-fit:cover}
.avatar-lg{width:140px;height:140px;border-radius:50%;object-fit:cover;border:4px solid #e9ecef;cursor:pointer}
.badge-kategori{background:#0d6efd}
.skeleton{height:48px;background:linear-gradient(90deg,#eee,#f5f5f5,#eee);animation:sh 1.5s infinite}
@keyframes sh{0%{background-position:-200px}100%{background-position:200px}}
</style>
</head>

<body>
<div class="container py-4">

<div class="header d-flex justify-content-between">
  <div>
    <h4>Dashboard UKOM JFK</h4>
    <small>Monitoring Peserta Uji Kompetensi Jabatan Fungsional</small>
  </div>
  <i class="bi bi-bar-chart fs-1 opacity-50"></i>
</div>

<div class="card shadow-sm rounded-4">
<table class="table align-middle mb-0">
<thead class="table-light">
<tr>
  <th>Foto</th><th>Nama</th><th>Unit</th><th>Jenis</th>
  <th>Jenjang</th><th>Kategori</th><th>JF</th><th>Jenjang Tujuan</th>
</tr>
</thead>
<tbody id="tbl">
<tr><td colspan="8"><div class="skeleton"></div></td></tr>
</tbody>
</table>
</div>
</div>

<!-- MODAL PROFIL -->
<div class="modal fade" id="profilModal">
<div class="modal-dialog modal-lg modal-dialog-centered">
<div class="modal-content rounded-4">
<div class="modal-header bg-primary text-white">
<h5 class="modal-title">Profil Peserta</h5>
<button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<div class="row g-4">
<div class="col-md-4 text-center">
<img id="p_foto" class="avatar-lg" onclick="openLightbox(this.src)">
</div>
<div class="col-md-8">
<h5 id="p_nama"></h5>
<div id="p_info" class="small text-muted"></div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- LIGHTBOX -->
<div id="lightbox" style="display:none;position:fixed;inset:0;background:#000c;z-index:9999" onclick="this.style.display='none'">
<img id="lightImg" style="max-width:90%;max-height:90%;margin:auto;display:block">
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz_DOUG4TuAgvRqI2hVz6hL7FpymucrAWl7PyOUp4SGFXPTwqDAwFsQoI1ZvISsC2F_Pw/exec";

function fallback(n){
  return `https://ui-avatars.com/api/?name=${encodeURIComponent(n)}&background=0D6EFD&color=fff`;
}

/* LOAD DASHBOARD */
fetch(API_URL+"?action=dashboard")
.then(r=>r.json())
.then(data=>{
  const t=document.getElementById("tbl"); t.innerHTML="";
  data.forEach(r=>{
    const foto=r.foto||fallback(r.nama);
    t.innerHTML+=`
    <tr onclick="openProfil('${r.nip}')">
      <td><img src="${foto}" class="avatar" loading="lazy" onerror="this.src='${fallback(r.nama)}'"></td>
      <td><b>${r.nama}</b></td>
      <td>${r.unit}</td>
      <td>${r.jenis}</td>
      <td>${r.jenjang}</td>
      <td><span class="badge badge-kategori">${r.kategori}</span></td>
      <td>${r.jf}</td>
      <td>${r.jenjangTujuan}</td>
    </tr>`;
  });
});

/* PROFIL */
function openProfil(nip){
fetch(API_URL+"?action=profil&nip="+nip)
.then(r=>r.json())
.then(r=>{
  if(!r.nip) return;
  p_nama.innerText=r.nama;
  p_info.innerHTML=`
  NIP: ${r.nip}<br>
  Unit: ${r.unit}<br>
  Jenis: ${r.jenis}<br>
  Jenjang: ${r.jenjang}<br>
  PAK: ${r.pak}<br>
  STR: ${r.str}<br><br>
  <b>Keputusan:</b><br>${r.keputusan}`;
  p_foto.src=r.foto||fallback(r.nama);
  new bootstrap.Modal(document.getElementById("profilModal")).show();
});
}

/* LIGHTBOX */
function openLightbox(src){
  document.getElementById("lightImg").src=src;
  document.getElementById("lightbox").style.display="flex";
}
</script>
</body>
</html>
