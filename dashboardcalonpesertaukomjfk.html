<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard UKOM JFK</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body{background:#f4f6f9}
.hidden{display:none}
.avatar{width:42px;height:42px;border-radius:50%;object-fit:cover}
.fullscreen{
  position:fixed;top:0;left:0;
  width:100%;height:100%;
  background:#fff;z-index:9999;
  overflow:auto;
}
</style>
</head>
<body>

<!-- DASHBOARD -->
<div id="dashboard" class="container py-4">
<h3>üìä Dashboard UKOM JFK</h3>
<table class="table table-hover bg-white">
<thead>
<tr>
<th>Foto</th><th>Nama</th><th>Unit</th><th>Jenis</th>
<th>Jenjang</th><th>Kategori</th><th>JF</th><th>Jenjang Tujuan</th>
</tr>
</thead>
<tbody id="tbl"></tbody>
</table>
</div>

<!-- LOGIN -->
<div id="login" class="hidden d-flex justify-content-center align-items-center vh-100">
<div class="card p-4" style="width:350px">
<h5>üîê Login Akses Profil</h5>
<input id="user" class="form-control mb-2" placeholder="Username">
<input id="pass" type="password" class="form-control mb-3" placeholder="Password">
<button class="btn btn-primary w-100" onclick="doLogin()">Masuk</button>
<button class="btn btn-link" onclick="show('dashboard')">Batal</button>
</div>
</div>

<!-- PROFIL -->
<div id="profil" class="fullscreen hidden p-4">
<button class="btn btn-secondary mb-3" onclick="show('dashboard')">‚Üê Kembali</button>
<div class="row">
<div class="col-md-8">
<h4 id="nama"></h4>
<ul class="list-group" id="detail"></ul>
</div>
<div class="col-md-4 text-center">
<img id="foto" class="img-fluid rounded">
</div>
</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz4ZjK2jvbYZdzTyqNsS0SllhUcMoZBVK2qx0SRL_ONVGcm8JFJ6Z3n_FcKo64MifuFhQ/exec";
let nipDipilih=null;

/* ===== LOAD DASHBOARD ===== */
fetch(API_URL+"?action=dashboard")
.then(r=>r.json())
.then(data=>{
  tbl.innerHTML="";
  data.forEach(r=>{
    tbl.innerHTML+=`
      <tr onclick="bukaLogin('${r[3]}')">
        <td><img src="${r[0]}" class="avatar"></td>
        <td>${r[1]}</td>
        <td>${r[5]}</td>
        <td>${r[6]}</td>
        <td>${r[7]}</td>
        <td>${r[11]}</td>
        <td>${r[12]}</td>
        <td>${r[13]}</td>
      </tr>`;
  });
});

/* ===== NAV ===== */
function show(id){
  ["dashboard","login","profil"].forEach(x=>{
    document.getElementById(x).classList.add("hidden");
  });
  document.getElementById(id).classList.remove("hidden");
}

function bukaLogin(nip){
  nipDipilih=nip;
  show("login");
}

/* ===== LOGIN ===== */
function doLogin(){
  fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"login",
      username:user.value.trim(),
      password:pass.value.trim()
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status){
      loadProfil();
    }else{
      alert("Username / Password salah");
    }
  });
}

/* ===== LOAD PROFIL ===== */
function loadProfil(){
  fetch(API_URL+"?action=profil&nip="+nipDipilih)
  .then(r=>r.json())
  .then(r=>{
    // Nama & Foto
    nama.innerText = r[1];
    foto.src = r[0];

    // Label PROFIL (URUT SESUAI SHEET)
    const field = [
      ["NIK", r[2]],
      ["NIP", r[3]],
      ["Nomor Telp / WA", r[4]],
      ["Unit Kerja", r[5]],
      ["Jenis Jabatan", r[6]],
      ["Jenjang Jabatan", r[7]],
      ["Pangkat dan Golongan", r[8]],
      ["Nilai PAK Terakhir", r[9]],
      ["Nomor STR", r[10]],
      ["Kategori Penjenjangan Jabatan", r[11]],
      ["Nama Jabatan Fungsional Yang Dituju", r[12]],
      ["Jenjang Jabatan Tujuan", r[13]],
      ["Keputusan Tim Pengelola UKOM JFK", r[14]]
    ];

    detail.innerHTML = "";
    field.forEach(f=>{
      detail.innerHTML += `
        <li class="list-group-item">
          <b>${f[0]}</b> : ${f[1] || "-"}
        </li>`;
    });

    show("profil");
  });
}
</script>

</body>
</html>
