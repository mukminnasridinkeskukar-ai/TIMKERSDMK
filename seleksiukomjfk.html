<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard Keputusan UKOM JFK</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;font-family:Inter,Arial;background:#f1f5f9}
.login,.dash{display:none}
.active{display:block}
.card{background:#fff;border-radius:16px;padding:20px;
box-shadow:0 10px 30px rgba(0,0,0,.12)}
img{width:90px;height:90px;border-radius:50%;cursor:pointer}
table{width:100%;border-collapse:collapse}
td,th{padding:10px;border-bottom:1px solid #e5e7eb}
.lightbox{position:fixed;inset:0;background:#0008;display:none;
align-items:center;justify-content:center}
.lightbox.active{display:flex}
.lb{background:#fff;padding:30px;border-radius:16px;max-width:700px}
</style>
</head>
<body>

<div class="login active" id="login">
  <div class="card">
    <h3>Login UKOM JFK</h3>
    <input id="u" placeholder="Username"><br>
    <input id="p" type="password" placeholder="Password"><br>
    <button onclick="login()">Masuk</button>
  </div>
</div>

<div class="dash" id="userDash"></div>
<div class="dash" id="adminDash"></div>

<div class="lightbox" id="lb">
  <div class="lb">
    <span onclick="lb.classList.remove('active')">‚ùå</span>
    <pre id="detail"></pre>
  </div>
</div>

<script>
const API="https://script.google.com/macros/s/AKfycbw9SV--A0ZEWD8qUr0BdbDrSicx9BYCyrwXSqncIK1Za7pSpIJTm1pDxc9UePNTc4Dxmg/exec";
let role="", nip="";

function login(){
fetch(API,{method:"POST",body:JSON.stringify({
action:"login",username:u.value,password:p.value
})}).then(r=>r.json()).then(d=>{
if(d.status==="ok"){
role=d.role; nip=d.nip;
login.classList.remove("active");
(role==="ADMIN"?loadAdmin():loadUser());
}else alert("Login gagal");
});
}

function loadUser(){
fetch(API,{method:"POST",body:JSON.stringify({
action:"profile",nip
})}).then(r=>r.json()).then(d=>{
const r=d.data;
userDash.classList.add("active");
userDash.innerHTML=`
<div class="card">
<img src="${r[16]}" onclick="show('${r.join("\\n")}')">
<h3>${r[2]}</h3>
<p>${r[4]}</p>
<p>${r[13]} - ${r[14]}</p>
<p><b>${r[15]}</b></p>
</div>`;
});
}

function loadAdmin(){
fetch(API,{method:"POST",body:JSON.stringify({
action:"all",role
})}).then(r=>r.json()).then(d=>{
adminDash.classList.add("active");
let h="<table><tr><th>Foto</th><th>Nama</th><th>NIP</th><th>JF</th></tr>";
d.rows.forEach(x=>{
h+=`<tr>
<td><img src="${x.foto}" onclick="show('${x.detail.join("\\n")}')"></td>
<td>${x.nama}</td>
<td>${x.nip}</td>
<td>${x.tujuan}</td>
</tr>`;
});
adminDash.innerHTML=h+"</table>";
});
}

function show(t){
detail.innerText=t;
lb.classList.add("active");
}
document.addEventListener("keydown",e=>{
if(e.key==="Escape") lb.classList.remove("active");
});
</script>
</body>
</html>
