<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Tupoksi</title>

<style>
:root{
  --primary:#6366f1;
  --primary-dark:#4f46e5;
  --bg:#f4f6fb;
  --card:#ffffff;
  --text:#1f2937;
}
*{box-sizing:border-box}

body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* ===== LOGIN ===== */
#loginBox{
  max-width:360px;
  margin:110px auto;
  background:var(--card);
  padding:36px;
  border-radius:22px;
  box-shadow:0 20px 50px rgba(0,0,0,.25);
  animation:fade .5s ease;
}
#loginBox h2{
  text-align:center;
  margin:0 0 20px;
}
#loginBox input{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:1px solid #ddd;
  font-size:15px;
}
#loginBox button{
  width:100%;
  margin-top:20px;
  padding:14px;
  border:none;
  border-radius:16px;
  background:linear-gradient(135deg,var(--primary),#818cf8);
  color:white;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
}
#loginBox button:disabled{
  opacity:.7;
  cursor:not-allowed;
}
#loginBox button:hover:not(:disabled){
  background:linear-gradient(135deg,var(--primary-dark),var(--primary));
}
#msg{
  margin-top:14px;
  text-align:center;
  font-size:14px;
}

/* ===== DASHBOARD ===== */
#dashboard{
  display:none;
  padding:24px;
  animation:slide .5s ease;
}
header{
  background:linear-gradient(135deg,var(--primary),#818cf8);
  color:white;
  padding:26px;
  border-radius:22px;
  box-shadow:0 15px 40px rgba(0,0,0,.25);
}
header h1{
  margin:0;
}
header p{
  margin:6px 0 0;
  opacity:.9;
}

/* ===== CONTROLS ===== */
.controls{
  display:flex;
  gap:14px;
  flex-wrap:wrap;
  margin:22px 0;
}
.controls input,
.controls select{
  padding:12px 14px;
  border-radius:14px;
  border:1px solid #ddd;
  min-width:240px;
  font-size:14px;
}

/* ===== TABLE ===== */
.table-wrap{
  background:white;
  border-radius:22px;
  box-shadow:0 15px 40px rgba(0,0,0,.15);
  overflow-x:auto;
}
table{
  width:100%;
  min-width:900px;
  border-collapse:collapse;
}
thead th{
  position:sticky;
  top:0;
  background:#eef2ff;
  z-index:1;
}
th,td{
  padding:14px 16px;
  white-space:nowrap;
  font-size:14px;
}
tbody tr:hover{
  background:#f9fafb;
}
.link-btn{
  background:var(--primary);
  color:white;
  padding:8px 14px;
  border-radius:10px;
  text-decoration:none;
  font-weight:600;
  font-size:13px;
}
.link-btn:hover{
  background:var(--primary-dark);
}

/* ===== ANIMATION ===== */
@keyframes fade{
  from{opacity:0}
  to{opacity:1}
}
@keyframes slide{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox">
  <h2>üîê Akses Dashboard</h2>
  <input id="password" type="password" placeholder="Masukkan Password">
  <!-- PENTING: type="button" (BUKAN submit) -->
  <button id="loginBtn" type="button" onclick="login()">Masuk</button>
  <p id="msg"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <header>
    <h1>üìä Dashboard Tugas Pokok & Fungsi</h1>
    <p>Sistem Informasi Internal</p>
  </header>

  <div class="controls">
    <input id="search" placeholder="üîç Cari sub kegiatan / penanggung jawab">
    <select id="filterTupoksi">
      <option value="">üìå Semua Tugas Pokok & Fungsi</option>
    </select>
  </div>

  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>No</th>
          <th>Tugas Pokok & Fungsi</th>
          <th>Sub Kegiatan</th>
          <th>Penanggung Jawab</th>
          <th>Pendamping</th>
          <th>Link Akses</th>
        </tr>
      </thead>
      <tbody id="tableData"></tbody>
    </table>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzoaI--DAq4ogc6jZccU-vg0qobfq5BiaedlsRdF0kew9JhDM4SDUKtjvcfEr9Nu1yN/exec";

let allData = [];

/* ===== LOGIN ===== */
function login(){
  const pwd = document.getElementById("password").value.trim();
  const btn = document.getElementById("loginBtn");
  const msg = document.getElementById("msg");

  if(!pwd){
    msg.style.color="red";
    msg.innerText="Password belum diisi";
    return;
  }

  btn.disabled = true;
  msg.style.color="#555";
  msg.innerText="Memverifikasi...";

  fetch(API,{
    method:"POST",
    body:new URLSearchParams({
      action:"login",
      password: pwd
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.status === "success"){
      document.getElementById("loginBox").style.display="none";
      document.getElementById("dashboard").style.display="block";
      loadData();
    }else{
      msg.style.color="red";
      msg.innerText="Password salah";
      btn.disabled = false;
    }
  })
  .catch(()=>{
    msg.style.color="red";
    msg.innerText="Gagal koneksi server";
    btn.disabled = false;
  });
}

/* ===== LOAD DATA ===== */
function loadData(){
  fetch(API,{
    method:"POST",
    body:new URLSearchParams({action:"data"})
  })
  .then(r=>r.json())
  .then(d=>{
    allData = d;
    renderTable(d);
    fillFilter(d);
  });
}

function renderTable(data){
  const tbody = document.getElementById("tableData");
  tbody.innerHTML = "";

  data.forEach((d,i)=>{
    tbody.innerHTML += `
      <tr>
        <td>${d.NO || i+1}</td>
        <td>${d["TUGAS POKOK DAN FUNGSI"] || ""}</td>
        <td>${d["SUB KEGIATAN"] || ""}</td>
        <td>${d["PENANGGUNG JAWAB"] || ""}</td>
        <td>${d.PENDAMPING || ""}</td>
        <td>
          ${d["LINK AKSES"]
            ? `<a class="link-btn" href="${d["LINK AKSES"]}" target="_blank">Buka</a>`
            : "-"
          }
        </td>
      </tr>`;
  });
}

function fillFilter(data){
  const select = document.getElementById("filterTupoksi");
  select.innerHTML = `<option value="">üìå Semua Tugas Pokok & Fungsi</option>`;

  [...new Set(data.map(d=>d["TUGAS POKOK DAN FUNGSI"]))].forEach(t=>{
    if(t) select.innerHTML += `<option value="${t}">${t}</option>`;
  });
}

document.getElementById("search").addEventListener("input", filterData);
document.getElementById("filterTupoksi").addEventListener("change", filterData);

function filterData(){
  const q = search.value.toLowerCase();
  const f = filterTupoksi.value;

  renderTable(
    allData.filter(d=>{
      const s =
        (d["SUB KEGIATAN"] || "").toLowerCase().includes(q) ||
        (d["PENANGGUNG JAWAB"] || "").toLowerCase().includes(q);
      return (!f || d["TUGAS POKOK DAN FUNGSI"] === f) && s;
    })
  );
}
</script>

</body>
</html>
